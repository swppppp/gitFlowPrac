<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                        
<!-- 네임스페이스(사용영역) 설정 -->
<mapper namespace="kr.or.kosta.shoppingmall.user">

	<!-- user객체 생성, users테이블에 생성 -->
	<insert id="create" parameterType="User">
		INSERT INTO users 
		VALUES     (#{id}, 
		            #{name}, 
		            #{passwd}, 
		            #{email}, 
		            SYSDATE)
	</insert>
	
	<!-- id값으로 해당 user 조회 -->
	<select id="read" parameterType="String" resultType="User">
			SELECT id,
				   name,
				   passwd,
				   email,
				   TO_CHAR(regdate, 'YYYY-MM-DD')
			FROM   users
			WHERE  id = #{value}
	</select>
	
	<!-- user객체 update -->
	<update id="update" parameterType="User">
		UPDATE users
		SET    passwd = #{passwd},
			   email = #{email}
		WHERE  id = #{id}
	</update>
	
	<!-- 전체 user조회 -->
	<select id="listAll" resultType="User">
		SELECT id,
			   name,
			   passwd,
			   email,
			   TO_CHAR(regdate, 'YYYY-MM-DD')
		FROM   users
	</select>
	
	<!-- 회원인지 확인..(인증) -->
	<select id="certify" parameterType="map" resultType="User">
		SELECT id,
			   name,
			   passwd,
			   email,
			   TO_CHAR(regdate, 'YYYY-MM-DD')
		FROM   users
		WHERE  id = ${id} AND passwd = ${passwd}
	</select>
	
	<select id="listByPage" parameterType="java.lang.Integer" resultType="User">
		SELECT id,
			   name,
			   passwd,
			   email,
			   regdate,
		FORM   (SELECT CEIL(rownum / 10) request_page,
					   id,
					   name,
					   passwd,
					   email,
					   regdate
				FROM   (SELECT id,
							   name,
							   passwd,
							   email,
							   TO_CHAR(regdate, 'YYYY-MM-DD') regdate
						FROM   users
						ORDER  BY regdate DESC))
		WHERE   request_page = ${page}
	</select>
	
</mapper>